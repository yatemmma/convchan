<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>convchan</title>
</head>
<body onLoad="init();">
<style type="text/css">
  *{margin:0;padding:0;font-size:12px;}
  body{margin:8px;}
  a{color:black}
  h1{display:inline}
  h1 a{text-decoration:none}
  .box{width:320px}
  #info{position: fixed;top:8px;right:8px}
</style>
<h1><a id="toplink" href="#">convchan 0.0.3</a></h1> <br />
<br />
<form name="form">
<div id="items">
  <div class="item">
    <span class="num">* </span>
    <input type="text" class="box" value="こんぶ" />
    <input type="text" class="box" value="昆布" />
    <input type="button" value="-" style="width:20px" onClick="del(this);" />
  </div>
  <div class="item">
    <span class="num">* </span>
    <input type="text" class="box" value="^([0-9]{4})/([0-9]{2})/([0-9]{2})" />
    <input type="text" class="box" value="$1年$2月$3日" />
    <input type="button" value="-" style="width:20px" onClick="del(this);" />
  </div>
  <div class="item">
    <span class="num">* </span>
    <input type="text" class="box" value="(convchan)" />
    <input type="text" class="box" value="*\t$1\t*" />
    <input type="button" value="-" style="width:20px" onClick="del(this);" />
  </div>
  <div class="item">
    <span class="num">* </span>
    <input type="text" class="box" value="" />
    <input type="text" class="box" value="" />
    <input type="button" value="-" style="width:20px" onClick="del(this);" />
  </div>
  <div class="item">
    <span class="num">* </span>
    <input type="text" class="box" value="" />
    <input type="text" class="box" value="" />
    <input type="button" value="-" style="width:20px" onClick="del(this);" />
  </div>
</div>
<input type="button" value="+" style="width:20px" onClick="add();" />
<input type="button" value="変換する" style="width:120px" onClick="conv();" />
<input type="button" value="クリア" style="width:60px" onClick="clearBox();" />
<a id="download" style="display:none;" href="#" target="blank">download</a>
<textarea id="ta" rows="50" wrap="off" style="width:100%;" spellcheck="false">convchan

連続置換ツールです。
上から順に文字列置換を繰り返します。

置換文字列はURLにセットされます。ブックマークしておくと便利です。
Chromeでしか動作確認してません。

こんぶ酢こんぶよろこんぶ
2011/01/01 2011/01/01
2011/02/01 2011/01/01
2011/03/01 2011/01/01

いろいろ便利にしていきます。


</textarea>
</form>

<div id="info">
<a href="https://twitter.com/yatemmma" target="_blank">@yatemmma</a>
</div>

<script type="text/javascript">

function conv() {
	var ta = document.getElementById('ta');
	ta.value = replaceAll(ta.value, getItems());
	setUrlParams();
	setDownloadUrl(ta.value);
	ta.select();
}

function add() {
  var items = document.getElementById('items');
  var node = items.children[0].cloneNode(true);
  var inputs = node.getElementsByClassName('box');
  inputs[0].value = "";
  inputs[1].value = "";
  items.appendChild(node);
}

function del(target) {
  if (target.parentElement.parentElement.children.length == 1) {
    return;
  }
  target.parentElement.parentElement.removeChild(target.parentElement);
}

function getItems() {
	var items = new Array();
	var inputs = document.form.getElementsByClassName('box');
	var i = 0;
	while (i < inputs.length) {
		var obj = {};
		obj.regexp = inputs[i].value;
		i++;
		obj.substr = inputs[i].value;
		items.push(obj);
		i++;
	}
	return items;
}

function replaceAll(text, items) {
	var t = text;
	for (var i in items) {
		var reg = new RegExp(items[i].regexp, "mg");
		t = t.replace(reg, items[i].substr);
		t = t.replace("\\t", "\t", "g").replace("\\n", "\n", "g").replace("\\r", "\r", "g");
	}
	return t;
}

function clearBox() {
	var inputs = document.form.getElementsByClassName('box');
	for (var i = 0; i < inputs.length; i++) {
		inputs[i].value = '';
	}
}

function setUrlParams() {
	var params = "#";
	var inputs = document.form.getElementsByClassName('box');
	for (var i = 0; i < inputs.length; i++) {
		params = params + '/' + encodeURIComponent(inputs[i].value);
	}
	window.location = params;
}

function setDownloadUrl(value) {
  var anchor = document.getElementById('download');
  anchor.style.display = 'inline';
  var blob = new Blob([value], {"type" : "text/plain"});
  if (window.URL) {
    anchor.href = window.URL.createObjectURL(blob);
  } else if (window.webkitURL) {
    anchor.href = window.webkitURL.createObjectURL(blob);
  } 
}

function init() {

	var url = window.location.href;
	setToplink(url);

	if (window.location.href.indexOf('#') == -1
			|| window.location.href.indexOf('#')+1 == window.location.href.length) {
		return;
	}
	var params = window.location.href.slice(window.location.href.indexOf('#')+2).split('/');
	var inputs = document.form.getElementsByClassName('box');
	for (var i = 0; i < inputs.length; i++) {
		inputs[i].value = decodeURIComponent(params[i]);
	}
	var ta = document.getElementById('ta');
	ta.value = '';
}

function urlToWordPairs(url) {
  var words = url.slice(url.indexOf('#') + 2).split('/');
  var pairs = new Array();
  for (var i = 0; i < words.length; i = i + 2) {
    var pair = {
      regexp : words[i],
      substr : words[i + 1]
    };
    if (pair.regexp || pair.substr) {
      pairs.push(pair);
    }
  }
  return pairs;
}

function displayWordPairs(pairs) {
  for (var i = 0; i < pairs.length; i++) {
    if (i == 0) {
      break;
    }
    console.log('add');
    add();
  }
}

function setToplink(url) {
	var link = url;
	if (url.indexOf('#') != -1) {
		link = url.split('#')[0];
	}
	var toplink = document.getElementById('toplink');
	toplink.href = link;
}
</script>
</body>
</html>

